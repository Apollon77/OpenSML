/*!
 * OpenSML
 * Copyright(c) 2014-2015 D. Spautz (d.spautz@web.de)
 * MIT Licensed
 */

var chai = require('chai');
chai.use(require('chai-change'));

var expect = require("chai").expect;
var should = require('chai').should;

describe("SmlCRC", function() {

	var SmlCRC = require("../lib/SmlCRC");

	describe("crc16CCITT()", function(){

        it("check sample message", function(){
            var data = Buffer.from("1b1b1b1b01010101760700190b4cbead6200620072630101760101070019063f3f8f0b0901454d48000041f045010163662d00760700190b4cbeae620062007263070177010b0901454d48000041f045070100620affff72620165063f2f357777078181c78203ff0101010104454d480177070100000009ff010101010b0901454d48000041f0450177070100010800ff6400018201621e52ff560009247a550177070100010801ff0101621e52ff560009247a550177070100010802ff0101621e52ff5600000000000177070100100700ff0101621b52ff55000016030177078181c78205ff0172620165063f2f3501018302e77ef33ea97bb6bba9bfa4fbd8b9f2ede51207b15acf6b98a237c21ca4982ee3ce18efe8438f1deba9d5c40eb68ae8f201010163574a00760700190b4cbeb16200620072630201710163d658000000001b1b1b1b1a03", "hex");
            var crc = SmlCRC.crc16CCITT(data);
            expect(crc.toString(16)).to.be.equal("66e5");
        });
    });

	describe("crc16CCITTRotate()", function(){

        it("check sample message", function(){
            var data = Buffer.from("1b1b1b1b01010101760700190b4cbead6200620072630101760101070019063f3f8f0b0901454d48000041f045010163662d00760700190b4cbeae620062007263070177010b0901454d48000041f045070100620affff72620165063f2f357777078181c78203ff0101010104454d480177070100000009ff010101010b0901454d48000041f0450177070100010800ff6400018201621e52ff560009247a550177070100010801ff0101621e52ff560009247a550177070100010802ff0101621e52ff5600000000000177070100100700ff0101621b52ff55000016030177078181c78205ff0172620165063f2f3501018302e77ef33ea97bb6bba9bfa4fbd8b9f2ede51207b15acf6b98a237c21ca4982ee3ce18efe8438f1deba9d5c40eb68ae8f201010163574a00760700190b4cbeb16200620072630201710163d658000000001b1b1b1b1a03", "hex");
            var crc = SmlCRC.crc16CCITTRotate(data);
            expect(crc.toString(16)).to.be.equal("e566");
        });
	});

	describe("crc16Kermit()", function(){

        it("check sample file", function(){
            var data = Buffer.from("1B1B1B1B01010101760400000162006200726500000101760101070000011D5C360B0A01484C59020001206A0101637DC60076040000026200620072650000070177010B0A01484C59020001206A0101F10477070100603201010101010104484C590177070100600100FF010101010B0A01484C59020001206A0177070100010800FF65001C010465011D5C36621E52FF6500DDC7560177070100020800FF65001C010465011D5C36621E52FF62000177070100100700FF0101621B52005302C80177070100200700FF0101622352FF6308F10177070100340700FF0101622352FF6308E40177070100480700FF0101622352FF6308EF01770701001F0700FF0101622152FE62260177070100330700FF0101622152FE62C90177070100470700FF0101622152FE62940177070100510701FF01016208520062790177070100510702FF01016208520062F00177070100510704FF010162085200620D017707010051070FFF01016208520063013F017707010051071AFF01016208520063014401770701000E0700FF0101622C52FF6301F30177070100000200000101010109312E30322E3030370177070100605A02010101010105413031410177070100600500FF0101010165001C010401010163522400760400000362006200726500000201710163EBF4000000001B1B1B1B1A03", "hex");
            var crc = SmlCRC.crc16Kermit(data);
            expect(crc.toString(16)).to.be.equal("f406");
        });

         it("check sample message", function(){
            var data = Buffer.from("760400000162006200726500000101760101070000011D5C360B0A01484C59020001206A0101", "hex");
            var crc = SmlCRC.crc16Kermit(data);
            expect(crc.toString(16)).to.be.equal("7dc6");
        });
	});
});
